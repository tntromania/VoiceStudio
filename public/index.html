<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voice Pro | OpenAI HD</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{--bg:#000;--card:#0d0d0d;--border:#1a1a1a;--accent:#a78bfa;--accent-dk:#7c3aed;--text:#fff;--muted:#94a3b8;--glow:rgba(167,139,250,.4);--success:#10b981}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:Outfit,sans-serif;background:#000;color:var(--text);min-height:100vh;overflow-x:hidden;position:relative}
        body::before{content:'';position:fixed;inset:0;background:radial-gradient(circle at 20% 10%,rgba(167,139,250,.15) 0%,transparent 40%),radial-gradient(circle at 80% 80%,rgba(16,185,129,.1) 0%,transparent 40%);pointer-events:none;z-index:0}
        body::after{content:'';position:fixed;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:.5;z-index:100}
        .grain{position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:1;opacity:.5}
        .app{max-width:1600px;margin:0 auto;padding:60px 40px 140px;position:relative;z-index:2}
        .header{text-align:center;margin-bottom:70px;position:relative}
        .logo-main{font-size:3rem;font-weight:800;margin-bottom:12px;background:linear-gradient(135deg,var(--text) 0%,var(--accent) 50%,var(--success) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-2px;position:relative;display:inline-block}
        .logo-main::before{content:'âš¡';position:absolute;left:-50px;top:50%;transform:translateY(-50%);font-size:2.5rem;filter:drop-shadow(0 0 20px var(--glow))}
        .tagline{color:var(--muted);font-size:1.15rem;font-weight:500;letter-spacing:2px;text-transform:uppercase}
        .main-grid{display:grid;grid-template-columns:1.2fr 450px;gap:40px;margin-bottom:60px}
        .editor-section{display:flex;flex-direction:column;gap:25px}
        .card{background:rgba(13,13,13,.6);backdrop-filter:blur(40px);border:1px solid var(--border);border-radius:28px;padding:35px;position:relative;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.5)}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
        .card-title{font-size:.8rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--muted)}
        .char-count{font-family:monospace;font-size:.85rem;color:var(--accent);background:rgba(167,139,250,.1);padding:6px 14px;border-radius:8px;font-weight:600}
        textarea{width:100%;min-height:450px;background:transparent;border:none;color:var(--text);font-family:Outfit,sans-serif;font-size:1.4rem;line-height:2;resize:none;outline:0}
        textarea::placeholder{color:#222;font-weight:300}
        .quick-actions{display:flex;gap:12px;flex-wrap:wrap}
        .quick-btn{padding:10px 18px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;font-size:.85rem;cursor:pointer;transition:.3s;font-weight:500;color:var(--muted);display:flex;align-items:center;gap:8px}
        .quick-btn:hover{border-color:var(--accent);background:rgba(167,139,250,.08);color:var(--text);transform:translateY(-2px)}
        .settings-panel{display:flex;flex-direction:column;gap:32px}
        .setting-block h3{font-size:.8rem;text-transform:uppercase;letter-spacing:2px;color:var(--muted);margin-bottom:18px;font-weight:700}
        .voice-select{background:rgba(255,255,255,.02);border:2px solid var(--border);border-radius:20px;padding:22px;cursor:pointer;transition:.3s;display:flex;align-items:center;gap:16px;position:relative}
        .voice-select:hover{border-color:var(--accent);background:rgba(167,139,250,.06);transform:translateY(-2px);box-shadow:0 8px 30px var(--glow)}
        .voice-avatar{width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,var(--accent),var(--accent-dk));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:1.5rem;box-shadow:0 8px 24px var(--glow)}
        .voice-details{flex:1}
        .voice-name{font-weight:700;font-size:1.1rem;margin-bottom:6px}
        .voice-desc{font-size:.88rem;color:var(--muted)}
        select{position:absolute;inset:0;opacity:0;cursor:pointer}
        .slider-wrap{margin-bottom:8px}
        .slider-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
        .slider-label{font-size:.92rem;font-weight:600;color:var(--text)}
        .slider-val{font-family:monospace;font-size:.95rem;color:var(--accent);background:rgba(167,139,250,.12);padding:5px 12px;border-radius:8px;font-weight:700}
        input[type=range]{width:100%;height:8px;background:rgba(255,255,255,.04);border-radius:4px;outline:0;-webkit-appearance:none;cursor:pointer;position:relative}
        input[type=range]::-webkit-slider-track{background:linear-gradient(to right,var(--accent) 0%,var(--accent) var(--value,50%),rgba(255,255,255,.04) var(--value,50%))}
        input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:24px;height:24px;background:var(--text);border-radius:50%;border:4px solid var(--accent);box-shadow:0 0 0 3px rgba(167,139,250,.2),0 6px 16px var(--glow);cursor:pointer;transition:.2s}
        input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.15);box-shadow:0 0 0 5px rgba(167,139,250,.3),0 8px 20px var(--glow)}
        .generate-btn{width:100%;padding:22px;background:linear-gradient(135deg,var(--accent) 0%,var(--accent-dk) 100%);color:#000;border:none;border-radius:18px;font-weight:800;font-size:1.12rem;cursor:pointer;transition:.3s;display:flex;align-items:center;justify-content:center;gap:12px;box-shadow:0 12px 36px var(--glow);position:relative;overflow:hidden;text-transform:uppercase;letter-spacing:1px}
        .generate-btn:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 16px 48px var(--glow)}
        .generate-btn:disabled{opacity:.5;cursor:not-allowed}
        .spinner{display:none;width:20px;height:20px;border:3px solid rgba(0,0,0,.3);border-top-color:#000;border-radius:50%;animation:spin .7s linear infinite}
        .generate-btn.loading .spinner{display:block}
        @keyframes spin{100%{transform:rotate(360deg)}}
        .history-section{margin-top:60px}
        .history-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
        .section-title{font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,var(--text),var(--muted));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .clear-btn{padding:10px 20px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:12px;color:#ef4444;font-size:.85rem;font-weight:600;cursor:pointer;transition:.3s}
        .history-grid{display:grid;gap:14px}
        .history-item{background:rgba(13,13,13,.4);border:1px solid var(--border);border-radius:18px;padding:18px 24px;display:flex;justify-content:space-between;align-items:center;transition:.3s;position:relative;overflow:hidden}
        .history-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent);transform:scaleY(0);transition:.3s}
        .history-item:hover{border-color:rgba(167,139,250,.4);background:rgba(167,139,250,.04)}
        .history-item:hover::before{transform:scaleY(1)}
        .history-text{flex:1;font-size:.95rem;color:var(--text);font-weight:500;margin-right:20px}
        .history-meta{display:flex;gap:20px;align-items:center;font-size:.82rem;color:var(--muted)}
        .meta-badge{background:rgba(167,139,250,.1);padding:6px 12px;border-radius:8px;font-weight:600;color:var(--accent)}
        .play-history{width:40px;height:40px;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s;color:var(--muted)}
        .play-history:hover{background:var(--accent);border-color:var(--accent);color:#000;transform:scale(1.1)}
        .player{position:fixed;bottom:0;left:0;right:0;height:100px;background:rgba(0,0,0,.98);backdrop-filter:blur(40px);border-top:1px solid var(--border);padding:0 60px;display:flex;align-items:center;gap:25px;transform:translateY(100%);transition:.5s cubic-bezier(.4,0,.2,1);z-index:200;box-shadow:0 -10px 50px rgba(0,0,0,.8)}
        .player.active{transform:translateY(0)}
        .play-circle{width:56px;height:56px;background:linear-gradient(135deg,var(--accent),var(--accent-dk));border:none;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s;box-shadow:0 8px 24px var(--glow);color:#000;font-size:1.3rem}
        .dl-link{padding:12px 24px;background:rgba(255,255,255,.06);border:1px solid var(--border);border-radius:14px;color:var(--text);text-decoration:none;font-weight:700;font-size:.92rem;transition:.3s;display:flex;align-items:center;gap:10px;text-transform:uppercase;letter-spacing:.5px}
        @media (max-width:1200px){.main-grid{grid-template-columns:1fr}.settings-panel{order:-1}}
        @media (max-width:768px){.app{padding:30px 20px 140px}.header{margin-bottom:50px}.main-grid{gap:25px}.card{padding:25px}textarea{font-size:1.2rem;min-height:350px}.player{padding:0 20px;height:90px}.history-item{flex-direction:column;align-items:flex-start;gap:12px}}
    </style>
</head>
<body>
<div class="grain"></div>
<div class="app">
    <header class="header">
        <h1 class="logo-main">Voice Pro</h1>
        <p class="tagline">OpenAI HD Speech Generation</p>
    </header>
    <div class="main-grid">
        <div class="editor-section">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Input Text</span>
                    <span class="char-count" id="charCnt">0 / 4096</span>
                </div>
                <textarea id="txt" placeholder="Type or paste your text here..."></textarea>
            </div>
            <div class="card">
                <div class="quick-actions">
                    <button class="quick-btn" onclick="clearText()"><i class="fas fa-eraser"></i> Clear</button>
                    <button class="quick-btn" onclick="pasteText()"><i class="fas fa-paste"></i> Paste</button>
                    <button class="quick-btn" onclick="copyText()"><i class="fas fa-copy"></i> Copy</button>
                    <button class="quick-btn" onclick="txt.value=sampleText();updateCount()"><i class="fas fa-flask"></i> Sample</button>
                </div>
            </div>
        </div>
        <div class="settings-panel">
            <div class="card">
                <div class="setting-block">
                    <h3>Voice Model</h3>
                    <div class="voice-select">
                        <div class="voice-avatar" id="vAvatar">A</div>
                        <div class="voice-details">
                            <div class="voice-name" id="vName">Alloy</div>
                            <div class="voice-desc" id="vDesc">Neutral & Balanced</div>
                        </div>
                        <select id="vSel" onchange="updateVoice()">
                            <option value="alloy" data-desc="Neutral & Balanced (General)">Alloy</option>
                            <option value="echo" data-desc="Deep & Masculine (Warm)">Echo</option>
                            <option value="fable" data-desc="British & Narrative (Expressive)">Fable</option>
                            <option value="onyx" data-desc="Deep & Intense (Authoritative)">Onyx</option>
                            <option value="nova" data-desc="Feminine & Warm (Calm)">Nova</option>
                            <option value="shimmer" data-desc="Clear & Bright (Feminine)">Shimmer</option>
                        </select>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="setting-block">
                    <h3>Speech Speed</h3>
                    <div class="slider-wrap">
                        <div class="slider-top">
                            <span class="slider-label">Playback Rate</span>
                            <span class="slider-val" id="spdVal">1.00x</span>
                        </div>
                        <input type="range" id="spdSlider" min="0.5" max="2.0" step="0.05" value="1.0">
                    </div>
                </div>
                <button class="generate-btn" id="genBtn" onclick="generate()">
                    <div class="spinner"></div>
                    <span id="genTxt"><i class="fas fa-wand-magic-sparkles"></i> Generate Speech</span>
                </button>
            </div>
        </div>
    </div>
    <section class="history-section">
        <div class="history-header">
            <h2 class="section-title">Recent Generations</h2>
            <button class="clear-btn" onclick="clearHistory()"><i class="fas fa-trash-alt"></i> Clear All</button>
        </div>
        <div class="history-grid" id="histList"></div>
    </section>
</div>
<div class="player" id="player">
    <button class="play-circle" id="playBtn"><i class="fas fa-play"></i></button>
    <a href="#" id="dlLink" class="dl-link" download><i class="fas fa-download"></i> Download MP3</a>
    <audio id="audio" style="display:none"></audio>
</div>
<script>
    const SERVER='/api';
    const txt=document.getElementById('txt');
    const spdSlider=document.getElementById('spdSlider');
    const audio=document.getElementById('audio');
    const player=document.getElementById('player');
    const playBtn=document.getElementById('playBtn');

    txt.value=localStorage.getItem('vp_text')||'';
    updateCount();

    txt.addEventListener('input',()=>{
        updateCount();
        localStorage.setItem('vp_text',txt.value);
    });

    spdSlider.oninput=(e)=>{
        const v=parseFloat(e.target.value);
        document.getElementById('spdVal').textContent=v.toFixed(2)+'x';
        e.target.style.setProperty('--value',(v-0.5)/(2.0-0.5)*100+'%');
    };
    spdSlider.dispatchEvent(new Event('input'));

    function updateCount(){
        const len=txt.value.length;
        document.getElementById('charCnt').textContent=len+' / 4096';
        document.getElementById('charCnt').style.color=len>4096?'#ef4444':'var(--accent)';
    }

    function updateVoice(){
        const s=document.getElementById('vSel');
        const o=s.options[s.selectedIndex];
        document.getElementById('vName').textContent=o.text;
        document.getElementById('vDesc').textContent=o.dataset.desc;
        document.getElementById('vAvatar').textContent=o.text[0];
    }

    function clearText(){
        if(confirm('Clear all text?')){
            txt.value='';
            updateCount();
            localStorage.removeItem('vp_text');
        }
    }

    async function pasteText(){
        try{
            const text=await navigator.clipboard.readText();
            txt.value=text;
            updateCount();
        }catch(e){alert('Paste failed. Use Ctrl+V instead.')}
    }

    function copyText(){
        if(!txt.value)return alert('No text to copy!');
        navigator.clipboard.writeText(txt.value);
    }

    function sampleText(){
        return "OpenAI's text-to-speech model is capable of generating human-like audio from text. The HD model produces high-quality audio suitable for content creation.";
    }

    async function generate(){
        const text=txt.value.trim();
        if(!text)return alert("Please enter some text!");
        // OpenAI limita este 4096 chars per request
        if(text.length>4096)return alert("Text too long! Max 4096 characters.");

        const btn=document.getElementById('genBtn');
        btn.classList.add('loading');
        btn.disabled=true;
        document.getElementById('genTxt').innerHTML='<i class="fas fa-spinner fa-spin"></i> Processing...';

        try{
            const res=await fetch(`${SERVER}/generate`,{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    text,
                    voice:document.getElementById('vSel').value,
                    speed:spdSlider.value
                })
            });

            if(!res.ok)throw new Error("Generation failed. Check server logs.");
            const blob=await res.blob();
            const url=URL.createObjectURL(blob);

            setupPlayer(url);
            addHistory(text,document.getElementById('vName').textContent,url);
        }catch(e){
            alert("Error: "+e.message);
        }finally{
            btn.classList.remove('loading');
            btn.disabled=false;
            document.getElementById('genTxt').innerHTML='<i class="fas fa-wand-magic-sparkles"></i> Generate Speech';
        }
    }

    function setupPlayer(url){
        audio.src=url;
        document.getElementById('dlLink').href=url;
        player.classList.add('active');
        audio.play();
        updatePlayIcon(true);
    }

    playBtn.onclick=()=>{
        if(audio.paused){
            audio.play();
            updatePlayIcon(true);
        }else{
            audio.pause();
            updatePlayIcon(false);
        }
    };

    audio.onended=()=>updatePlayIcon(false);

    function updatePlayIcon(playing){
        playBtn.innerHTML=playing?'<i class="fas fa-pause"></i>':'<i class="fas fa-play"></i>';
    }

    function addHistory(text,voice,url){
        const hist=JSON.parse(localStorage.getItem('vp_hist')||'[]');
        const preview=text.length>60?text.substring(0,60)+'...':text;
        hist.unshift({
            text:preview,
            voice,
            time:new Date().toLocaleString('ro-RO',{hour:'2-digit',minute:'2-digit'}),
            url,
            id:Date.now()
        });
        if(hist.length>10)hist.pop();
        localStorage.setItem('vp_hist',JSON.stringify(hist));
        renderHistory();
    }

    function renderHistory(){
        const hist=JSON.parse(localStorage.getItem('vp_hist')||'[]');
        const list=document.getElementById('histList');

        if(!hist.length){
            list.innerHTML='<div style="text-align:center;color:#444;padding:20px;">No history yet.</div>';
            return;
        }

        list.innerHTML=hist.map(h=>`
<div class="history-item">
<div class="history-text">${h.text}</div>
<div class="history-meta">
<span class="meta-badge">${h.voice}</span>
<span>${h.time}</span>
</div>
<button class="play-history" onclick="setupPlayer('${h.url}')"><i class="fas fa-play"></i></button>
</div>
`).join('');
    }

    function clearHistory(){
        if(confirm('Clear history?')){
            localStorage.removeItem('vp_hist');
            renderHistory();
        }
    }

    renderHistory();
</script>
</body>
</html>